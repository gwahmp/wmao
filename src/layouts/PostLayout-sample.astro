---
import BaseLayout from "./BaseLayout.astro";
import "../styles/global.css";

const { frontmatter, url } = Astro.props;
const {
  title, description, date, updatedDate, image, canonical,
  tags, toc, learnPoints, relatedResources, faq, author
} = frontmatter;
---
<BaseLayout title={`${title} | Wikimint`} description={description}>
  <head>
    <link rel="canonical" href={canonical ?? url?.href} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    {image && <meta property="og:image" content={image} />}
    <meta name="twitter:card" content="summary_large_image" />
    <!-- Article JSON-LD -->
    <script type="application/ld+json">
      {JSON.stringify({
        "@context":"https://schema.org",
        "@type":"Article",
        headline: title,
        description,
        datePublished: date,
        dateModified: updatedDate ?? date,
        author: [{ "@type":"Person", name: author }],
        image: image ? [image] : undefined,
        mainEntityOfPage: canonical ?? url?.href
      })}
    </script>
    {faq?.length > 0 && (
      <script type="application/ld+json">
        {JSON.stringify({
          "@context":"https://schema.org",
          "@type":"FAQPage",
          mainEntity: faq.map((f:any)=>({
            "@type":"Question",
            name:f.q,
            acceptedAnswer:{ "@type":"Answer", text:f.a }
          }))
        })}
      </script>
    )}
  </head>

  <!-- 3-Column Layout -->
  <div class="grid grid-cols-12 gap-6 max-w-7xl mx-auto px-4">
    
    <!-- Column 1: Article (50%) -->
    <div class="col-span-6">
      <article class="prose prose-zinc">
        <header class="not-prose mb-6">
          <h1>{title}</h1>
          <p class="text-sm opacity-70">{new Date(date).toDateString()} Â· {author}</p>
          {image && <img src={image} alt={title} class="mt-4 rounded-xl" loading="lazy" />}
        </header>

        {frontmatter.summary && (
          <section class="not-prose my-6 p-4 rounded-xl bg-zinc-50 border">
            <h2 class="m-0 text-lg font-semibold">Summary</h2>
            <p class="m-0">{frontmatter.summary}</p>
          </section>
        )}

        {toc && (
          <div class="wmdTOC">
            <button>
              Table of Contents
              <span>
                [<a rel="nofollow" onclick="mbtToggle2()" id="Tog">Hide</a>]
              </span>
            </button>
            <div id="wmdTOC" style="display:block;">
              <Fragment set:html={toc.replace(/<h2.*?<\/h2>/, "")} />
            </div>
          </div>
        )}

        <slot /> {/* Markdown content */}

        {faq?.length > 0 && (
          <section class="not-prose my-8">
            <h2>FAQ</h2>
            {faq.map((f:{q:string,a:string}) => (
              <details class="mb-3">
                <summary class="cursor-pointer">{f.q}</summary>
                <div set:html={f.a} />
              </details>
            ))}
          </section>
        )}
      </article>

      <!-- Comments placeholder -->
      <section class="not-prose mt-12">
        <h2 class="text-xl font-semibold">Comments</h2>
        <p class="opacity-70">Comments feature coming soon.</p>
      </section>
    </div>

    <!-- Column 2: Sticky Top Ads (25%) -->
    <div class="col-span-3">
      <div class="sticky top-4">
        <div class="bg-gray-100 border rounded-lg p-4">
          <p class="font-semibold">Advertisement</p>
          <div class="h-96 flex items-center justify-center text-sm text-gray-500">Ad Space</div>
        </div>
      </div>
    </div>

    <!-- Column 3: Sticky Bottom Ads (25%) -->
    <div class="col-span-3">
      <div class="sticky bottom-4">
        <div class="bg-gray-100 border rounded-lg p-4">
          <p class="font-semibold">Advertisement</p>
          <div class="h-96 flex items-center justify-center text-sm text-gray-500">Ad Space</div>
        </div>
      </div>
    </div>

  </div>

  <script>
    function mbtToggle2() {
      const toc = document.getElementById("wmdTOC");
      const link = document.getElementById("Tog");
      if (toc.style.display === "none") {
        toc.style.display = "block";
        link.innerText = "Hide";
      } else {
        toc.style.display = "none";
        link.innerText = "Show";
      }
    }
  </script>
</BaseLayout>
