---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import Sidebar from "../components/Sidebar.astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  const categories = await getCollection("category");

  return categories.map((cat) => ({
    params: { category: cat.slug },   // slug is the filename of your md file
    props: { category: cat, posts },
  }));
}

interface Props {
  category: Awaited<ReturnType<typeof getCollection>>[0];
  posts: Awaited<ReturnType<typeof getCollection>>;
}
const { category, posts } = Astro.props as Props;

// filter posts by category slug
const categoryPosts = posts.filter(
  (p) => p.data.category.toLowerCase() === category.slug.toLowerCase()
);

const { Content } = await category.render();

---

<BaseLayout>
  <div class="grid grid-cols-1 md:grid-cols-12 gap-6 md:gap-10 max-w-7xl mx-auto">
    <main class="col-span-12 md:col-span-7 prose lg:prose-xl max-w-none">
      
      <!-- Category Metadata -->
      <h1 class="text-3xl font-bold mb-2">{category.data.title}</h1>
      <!-- {category.data.image && (
        <img src={category.data.image} alt={category.data.title} class="rounded-lg mb-4"/>
      )} -->
      <p class="bluebox">{category.data.description}</p>

            <!-- Posts list -->
            <h2 class="text-2xl font-semibold mt-10 mb-4">Posts in {category.data.title}</h2>
            <ul class="space-y-6">
              {categoryPosts.map((post) => (
                <li class="border-b pb-4">
                  <a href={`/${post.slug}`} class="text-lg font-semibold hover:underline">
                    {post.data.title}
                  </a>
                  {post.data.description && (
                    <p class="text-gray-600 mt-1">{post.data.description}</p>
                  )}
                  <p class="text-sm text-gray-500">
                    {post.data.date.toDateString()}
                  </p>
                </li>
              ))}
            </ul>

      <!-- Render markdown content from category file -->
      <Content />


    </main>

    <aside class="col-span-12 md:col-span-5">
      <Sidebar />
    </aside>
  </div>
</BaseLayout>
