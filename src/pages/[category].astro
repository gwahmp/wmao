---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection, render } from "astro:content"; // ðŸ‘ˆ import render
import Sidebar from "../components/Sidebar.astro";
import type { CollectionEntry } from "astro:content";

type Post = CollectionEntry<"posts">;
type Category = CollectionEntry<"category">;

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  const categories: Category[] = await getCollection("category");

  return categories.map((cat) => ({
    params: { category: cat.slug },
    props: { category: cat, posts },
  }));
}

const { category, posts } = Astro.props as {
  category: Category;
  posts: Post[];
};

const categoryPosts = posts.filter(
  (p) => p.data.category?.toLowerCase() === category.slug.toLowerCase()
);

// ðŸ‘‡ use render() helper
const { Content } = await render(category);
---




<BaseLayout 
  title={category.data.title} 
  description={category.data.description}
>
  <div class="grid grid-cols-1 md:grid-cols-12 gap-6 md:gap-10 max-w-7xl mx-auto">
    <main class="col-span-12 md:col-span-7 prose lg:prose-xl max-w-none">
      
      <!-- Category Metadata -->
      <h1 class="text-3xl font-bold mb-2">{category.data.h1}</h1>
      <p class="bluebox">{category.data.description}</p>

      <!-- Posts list -->
      <h2 class="text-2xl font-semibold mt-10 mb-4">
        Posts in {category.data.title}
      </h2>
      <ul class="space-y-6">
        {categoryPosts.map((post: Post) => (
          <li class="border-b pb-4">
            <a href={`/${post.slug}`} class="text-lg font-semibold hover:underline">
              {post.data.title}
            </a>
            {post.data.description && (
              <p class="text-gray-600 mt-1">{post.data.description}</p>
            )}
            {post.data.date && (
              <p class="text-sm text-gray-500">
                {new Date(post.data.date).toDateString()}
              </p>
            )}
          </li>
        ))}
        
      </ul>

      <!-- Render markdown content from category file -->
      <Content />
    </main>

    <aside class="col-span-12 md:col-span-5">
      <Sidebar />
    </aside>
  </div>
</BaseLayout>
