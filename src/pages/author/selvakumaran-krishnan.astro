---
import { getEntryBySlug, getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

const { author } = Astro.params;
const profile = author ? await getEntryBySlug("authors", author) : null;
if (!profile) return Astro.redirect("/404");

const posts = (await getCollection("posts", ({ data }) => data.author === author))
  .sort((a,b)=> new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
---
<BaseLayout title={`${profile.data.name} — Author | Wikimint`}>
  <section class="max-w-3xl mx-auto py-10">
    <div class="flex items-center gap-4">
      {profile.data.image && <img src={profile.data.image} alt={profile.data.name} class="w-16 h-16 rounded-full" />}
      <div>
        <h1 class="text-3xl font-bold">{profile.data.name}</h1>
        {profile.data.bio && <p class="opacity-80">{profile.data.bio}</p>}
      </div>
    </div>

    <h2 class="text-xl font-semibold mt-8">Posts by {profile.data.name}</h2>
    <ul class="mt-4 space-y-2">
      {posts.map(p => (
        <li>
          <a class="underline" href={`/${p.slug}`}>{p.data.title}</a>
          <span class="text-sm opacity-60"> — {new Date(p.data.date).toDateString()}</span>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>
